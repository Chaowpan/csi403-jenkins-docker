pipeline {
    agent any

    environment {
        DOCKER_IMAGE_NAME = 'my-react-app'
        CONTAINER_NAME = 'my-react-app-run'
        DOCKER_PORT = '3000'
        HOST_PORT = '3000'
    }

    stages {
        stage('Check Out') {
            steps {
                echo "üîç Checking Out Code"
                checkout([
                    $class: 'GitSCM', 
                    branches: [[name: '*/main']],
                    userRemoteConfigs: [[
                        credentialsId: 'Your-Credentials-ID', 
                        url: 'https://github.com/YourUsername/YourRepo.git'
                    ]]
                ])
                echo "‚úÖ Clone Success"
            }
        }

        stage('Build Docker Image') {
            steps {
                echo "üöÄ Building Docker Image"
                script {
                    sh "docker build -t ${DOCKER_IMAGE_NAME} ."
                    echo "‚úÖ Docker Image Build Success"
                }
            }
        }

        stage('Deploy Container') {
            steps {
                echo "üì¶ Running Docker Container"
                script {
                    // ‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏•‡∏ö container ‡πÄ‡∏î‡∏¥‡∏°‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
                    sh "docker rm -f ${CONTAINER_NAME} || true"
                    // ‡∏£‡∏±‡∏ô container ‡πÉ‡∏´‡∏°‡πà
                    sh "docker run -d --name ${CONTAINER_NAME} -p ${HOST_PORT}:${DOCKER_PORT} ${DOCKER_IMAGE_NAME}:latest"
                    echo "‚úÖ Docker Container Running Successfully"
                }
            }
        }

        stage('Test') {
            steps {
                echo "üß™ Running Tests"
                script {
                    // ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏î‡πâ)
                    sh "curl -f http://localhost:${HOST_PORT} || exit 1"
                    echo "‚úÖ Tests Passed Successfully"
                }
            }
        }
    }

    post {
        failure {
            echo "‚ùå Pipeline Failed. Please check the logs."
        }
        success {
            echo "üéâ Pipeline Completed Successfully."
        }
    }
}
